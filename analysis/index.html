<!DOCTYPE html>
<html lang="en" ng-app="analysis">
<head>
    <meta charset="UTF-8">
    <title>Analysis</title>
    <link rel="stylesheet" type="text/css" href="../styles/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="../scripts/angular.min.js"></script>
    <script src="../scripts/jquery-3.1.1.min.js"></script>
    <script src="../styles/bootstrap/js/bootstrap.min.js"></script>
    <script src="../scripts/ui-bootstrap-tpls-2.3.2.min.js"></script>
    <script src="../common/fileInput.js"></script>
    <script src="../common/thumbnail.js"></script>
    <script src="../common/modalComponent.js"></script>
    <script src="d3.js"></script>
    <script src="analysis.js"></script>
</head>
<body>

    <div ng-controller="analysisController" class="container-fluid">
        <div ng-if="view=='opener'">
            <div class="row">
                <div class="col-lg-offset-4 col-md-offset-4 col-lg-4 col-md-4">
                    <h4>Open a preset:</h4>
                    <select class="form-control" ng-model="formModel.preset" ng-change="open()">
                        <option value="">Select Preset</option>
                        <option ng-repeat="p in presets track by $index" ng-value="p">{{p}}</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="row" ng-if="data_ready && view=='overview'" >
            <div class="col-lg-9 col-md-9 col-sm-9 col-xs-9">
                <h4 class="text-center">Feature Vectors {{formModel.preset}}</h4>
                <plot plot-info="plotInfo" dataset="dataset"></plot>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3">
                <div class="pager">
                    <div class="btn-group" data-toggle="buttons">
                        <button class="btn btn-xs" ng-class="{'btn-primary': plotInfo.isBySubject, 'btn-default': !plotInfo.isBySubject}" ng-click="plotInfo.isBySubject = true">
                            By Subject
                        </button>
                        <button class="btn btn-xs" ng-class="{'btn-primary': !plotInfo.isBySubject, 'btn-default': plotInfo.isBySubject}" ng-click="plotInfo.isBySubject = false">
                            By Cluster
                        </button>
                    </div>
                    <div ng-if="template">
                        <div ng-repeat="t in [template]"> <!-- force thumbnail update when selection is modified -->
                            <thumbnail img-src="{{::imageDir}}/{{t.FILENAME}}"
                                       box-x="t.FACE_X"
                                       box-y="t.FACE_Y"
                                       box-width="t.FACE_WIDTH"
                                       box-height="t.FACE_HEIGHT"
                                       display-width="200"
                                       display-height="200"
                                       crop=true
                                       class="img-thumbnail"
                                       ng-click="showImage(t, true)"
                                       style="cursor: pointer">

                            </thumbnail>
                        </div>
                        <div ng-switch="plotInfo.isBySubject">
                            <span ng-switch-when="true"><b>Subject ID: {{subject_id}}</b>, Cluster ID: {{cluster_id}}</span>
                            <span ng-switch-when="false">Subject ID: {{subject_id}}, <b>Cluster ID: {{cluster_id}}</b></span>
                        </div>
                        <div>
                            <input type="checkbox" id="cbviewall" ng-model="plotInfo.viewSingleGroup">
                            <label for="cbviewall" ng-switch="plotInfo.isBySubject">
                                <span ng-switch-when="true">Show only this subject on plot</span>
                                <span ng-switch-when="false">Show only this cluster on plot</span>
                            </label>
                        </div>
                        <div ng-show="plotInfo.isBySubject">
                            <thumbnail ng-repeat="t in subject_templates | limitTo: 8"
                                       img-src="{{::imageDir}}/{{t.FILENAME}}"
                                       box-x="t.FACE_X"
                                       box-y="t.FACE_Y"
                                       box-width="t.FACE_WIDTH"
                                       box-height="t.FACE_HEIGHT"
                                       display-width="50"
                                       display-height="50"
                                       crop=true
                                       class="img-thumbnail"
                                       ng-click="showImage(t, true)"
                                       style="cursor: pointer">

                            </thumbnail>
                            <div>
                                <button ng-if="subject_templates.length > 8" type="button" class="btn btn-primary btn-xs" ng-click="showSubject()" style="vertical-align: bottom;">{{subject_templates.length-8}} more</button>
                            </div>
                        </div>
                        <div ng-show="!plotInfo.isBySubject">
                            <thumbnail ng-repeat="t in cluster_templates | limitTo: 8"
                                   img-src="{{::imageDir}}/{{t.FILENAME}}"
                                   box-x="t.FACE_X"
                                   box-y="t.FACE_Y"
                                   box-width="t.FACE_WIDTH"
                                   box-height="t.FACE_HEIGHT"
                                   display-width="50"
                                   display-height="50"
                                   crop=true
                                   class="img-thumbnail"
                                   ng-click="showImage(t, true)"
                                   style="cursor: pointer">

                            </thumbnail>
                            <div>
                                <button ng-if="cluster_templates.length > 8" type="button" class="btn btn-primary btn-xs" ng-click="showCluster()" style="vertical-align: bottom;">{{cluster_templates.length-8}} more</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- subject view -->
        <div ng-if="data_ready && view=='subject'">
            <div class="row">
                <div class="col-lg-4 col-md-4">
                    <button type="button" class="btn btn-primary btn-sm" ng-click="showOverview()">Back</button>
                </div>
                <div class="col-lg-4 col-md-4 text-center">
                    <h4>Subject {{subject_id}} has {{subject_templates.length}} images</h4>
                </div>
            </div>

            <div>
                <thumbnail ng-repeat="t in subject_templates | orderBy: '-CONFIDENCE' track by $index"
                           img-src="{{::imageDir}}/{{::t.FILENAME}}"
                           box-x="t.FACE_X"
                           box-y="t.FACE_Y"
                           box-width="t.FACE_WIDTH"
                           box-height="t.FACE_HEIGHT"
                           display-width="200"
                           display-height="200"
                           crop=true
                           ng-click="showImage(t, true)"
                           class="img-thumbnail"
                           style="cursor: pointer"></thumbnail>
            </div>
        </div>


        <!-- cluster view -->
        <div ng-if="data_ready && view=='cluster'">
            <div class="row">
                <div class="col-lg-4 col-md-4">
                    <button type="button" class="btn btn-primary btn-sm" ng-click="showOverview()">Back</button>
                </div>
                <div class="col-lg-4 col-md-4 text-center">
                    <h4>Cluster {{cluster_id}} has {{cluster_templates.length}} images</h4>
                </div>
            </div>

            <div>
                <thumbnail ng-repeat="t in cluster_templates | orderBy: '-CONFIDENCE' track by $index"
                           img-src="{{::imageDir}}/{{::t.FILENAME}}"
                           box-x="t.FACE_X"
                           box-y="t.FACE_Y"
                           box-width="t.FACE_WIDTH"
                           box-height="t.FACE_HEIGHT"
                           display-width="200"
                           display-height="200"
                           crop=true
                           ng-click="showImage(t, true)"
                           class="img-thumbnail"
                           style="cursor: pointer"></thumbnail>
            </div>
        </div>
    </div>

</body>
</html>